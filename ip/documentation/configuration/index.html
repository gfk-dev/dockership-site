<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
    <title>Configuration</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

    
    

    <script type="text/javascript"
      src="https://code.jquery.com/jquery-2.1.1.min.js"
    ></script>

    
    <link rel="stylesheet" href="https://yandex.st/highlightjs/8.0/styles/github.min.css">
    <script type="text/javascript"
      src="https://yandex.st/highlightjs/8.0/highlight.min.js"
    ></script>

    
    <script type="text/javascript"
      src="//cdnjs.cloudflare.com/ajax/libs/headroom/0.6.0/headroom.min.js"
    ></script>
    <script type="text/javascript"
      src="//cdnjs.cloudflare.com/ajax/libs/headroom/0.6.0/jQuery.headroom.min.js"
    ></script>

    
    <link
      href="//maxcdn.bootstrapcdn.com/bootswatch/3.2.0/simplex/bootstrap.min.css"
      rel="stylesheet"
    />
    <script type="text/javascript"
      src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"
    ></script>

    <script type="text/javascript">
    $(document).ready(function() {
      var header = document.querySelector(".headroom");
      new Headroom(header, {
        tolerance: {
          down : 10,
          up : 50
        },
        offset : 50}).init();
      hljs.initHighlightingOnLoad();
    });
    </script>


    <style type="text/css">
      body {
        font-size: 16px;
      }
      #navbar-main {
        margin-top: 5px;
      }
      .feature {
        padding-top: 5.5em;
        padding-bottom: 2.5em;
      }
      .feature {
        background-color: #F4F0E6;
        padding: 4em 0 2em 0;
        text-align: center;
      }
      .feature h1 {
        background-image: url(/ip/images/dockership.png);
        background-repeat: no-repeat;
        background-size: 500px;
        background-position: center center;
        display: block;
        height: 90px;
        margin-left:-55px;

      }
      .feature h1 span { display: none; }
      .headroom {
        transition: transform 200ms linear;
      }
      .headroom--unpinned .navbar-brand {
        width: 60px;
        transition: width 1s;
      }

      .headroom--pinned .navbar-brand {
        width: 200px;
        transition: width 1s;
      }

      .container {
        max-width: 50em;
        margin: 0 auto;
        padding: 0 1.5em;
      }
      .main h1 {
        padding-bottom: 10px;
        margin-bottom: 40px;
        border-bottom: 1px solid;
      }

      .navbar-brand {
        background-image: url(/ip/images/dockership.png);
        background-repeat: no-repeat;
        background-size: 200px;
        width: 200px;
        margin:5px;
      }

      .navbar-brand span { display: none;}
      .main { margin-top: 50px;}
      .feature .btn { width: 200px; margin-top: 10px; }

      footer { padding-top: 60px !important; }
      footer a { color: #808080; font-weight: bolder; }

       
      .btn-primary, .btn-primary:hover {
        border: 1px solid #634224;
        background-image: linear-gradient(#936B47 , #936B47 6%, #82582D);
      }
    </style>
    </head>
    <body>
      <header class="navbar navbar-default navbar-fixed-top headroom">
          <div class="container">
            <div class="navbar-header">
              <a href="/" class="navbar-brand"><span>Dockership</span></a>
              <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
            </div>
            <div class="navbar-collapse collapse" id="navbar-main">
              <ul class="nav navbar-nav">
                
                  
                
                  
                  <li class="dropdown">
                  <a
                    class="dropdown-toggle" data-toggle="dropdown" 
                    href="/documentation" id="documentation">
                      Documentation
                      <span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu" aria-labelledby="themes">
                    
                    <li><a href="/ip/documentation/extending_dockership/">Extending Dockership</a></li>
                    
                    <li><a href="/ip/documentation/scaffolding_strategies/">Scaffolding Strategies</a></li>
                    
                    <li><a href="/ip/documentation/creating_your_dockerfiles/">Creating your Dockerfiles</a></li>
                    
                    <li><a href="/ip/documentation/configuration/">Configuration</a></li>
                    
                  </ul>
                  </li>
                  
                

                
                <li>
                  <a href="https://github.com/mcuadros/dockership/issues" target="_blank">Issues</a>
                </li>
                
                
                <li class="dropdown">
                  <a href="https://github.com/mcuadros/dockership/releases" target="_blank">Download</a>
                </li>
                
              </ul>

              
              <ul class="nav navbar-nav navbar-right">
                <li><a href="https://github.com/mcuadros/dockership" target="_blank">
                  <i class="fa fa-github"></i> Github</a>
                </a></li>
              </ul>
              
            </div>
          </div>
        </div>
      </header>


<div class="container main">
  

<h1 id="toc_0">Configuration</h1>

<p>The <strong>dockership</strong> configuration is based on an INI-formatted config file.</p>

<p>Dockership will look at <code>/etc/dockership/dockership.conf</code> for this config file by default. The <code>-config</code> flag may be passed to the <code>dockershipd</code> or <code>dockership</code> binaries to use a custom config file location.</p>

<h2 id="toc_1">Syntax</h2>

<p>The config file syntax is based on <a href="http://git-scm.com/docs/git-config#_syntax">git-config</a>, with minor changes.</p>

<p>The file consists of <strong>sections</strong> and <strong>variables</strong>. A section begins with the name of the section in square brackets and continues until the next section begins. Section names are not case sensitive. Only alphanumeric characters, - and . are allowed in section names. Each variable must belong to some section, which means that there must be a section header before the first setting of a variable.</p>

<p>Sections can be further divided into subsections. To begin a subsection put its name in double quotes, separated by space from the section name, in the section header, like in the example below:</p>

<pre><code class="language-ini">; Comment line
[section &quot;subsection&quot;]
name = value # Another comment
flag # implicit value for bool is true
</code></pre>

<h2 id="toc_2">Sections</h2>

<h3 id="toc_3">Global</h3>

<p>A miscellaneous of configuration variables used across the whole tool.</p>

<ul>
<li><p><code>GithubToken</code> (mandatory): a Github <a href="https://github.com/settings/tokens/new">personal access token</a> used in every request to the <a href="https://developer.github.com/">Github API</a>.</p></li>

<li><p><code>UseShortRevisions</code> (default: true): if it is false all the images and containers will be defined using full length revision names, instead the short ones.</p></li>

<li><p><code>EtcdServer</code> (multiple, optional): etcd server, needed for etcd variables at the Dockerfiles.</p></li>
</ul>

<h3 id="toc_4">HTTP</h3>

<p>Configuration of the web server from <code>dockershipd</code>. <em>This section is only required by dockershipd</em></p>

<p>Since the authentication is based on a registered <a href="https://github.com/settings/applications/new">Github Application</a>, you should <a href="https://github.com/settings/applications/new">create it</a> at Github. The <em>Authorization callback URL</em> must be filled with <code>http://&lt;server-addr&gt;/oauth2callback</code>, this URL should be accessible by anyone.</p>

<ul>
<li><code>Listen</code> (default: 0.0.0.0:80): the TCP network address</li>
<li><code>GithubID</code> (mandatory): the <code>Client ID</code> provided by Github</li>
<li><code>GithubSecret</code> (mandatory): the <code>Client Secret</code> provided by Github</li>
<li><code>GithubOrganization</code> (optional): only the members from this Github Organization are allowed to access.</li>
<li><code>GithubUser</code> (multiple, optional): Github user allowed to access into Dockership</li>
<li><code>GithubRedirectURL</code> (mandatory): the <code>Authorization callback URL</code> configured in Github</li>
</ul>

<h3 id="toc_5">Environment</h3>

<p>An environment is a logical group of any number of Docker servers. Dockership supports multiple environments. Each <code>Environment</code> is defined as a section with subsection: <code>[Environment &quot;production&quot;]</code></p>

<ul>
<li><p><code>DockerEndPoint</code> (mandatory, multiple): <a href="https://docs.docker.com/reference/api/docker_remote_api/">Docker Remote API</a> address, if dockership and Docker are running in the same host you can use <code>unix:///var/run/docker.sock</code> if not you should enable remote access at the docker daemon (with -H parameter) and use a TCP endpoint. (eg.: <code>tcp://172.17.42.1:4243</code>)</p></li>

<li><p><code>CertPath</code> (optional): If you are running Docker with TLS support you must provide the path to your keys files, just like the <a href="https://docs.docker.com/articles/https/">DOCKER_CERT_PATH</a> looks.</p></li>

<li><p><code>EtcdServer</code> (multiple, optional): if none is configured the <code>Global.EtcdServer</code> will be used</p></li>
</ul>

<h3 id="toc_6">Project</h3>

<p><code>Project</code> section defines the configuration for every project to be deployed in the environments. The relation between repositories is one-to-one, so the repository should contain the <code>Dockerfile</code> and all the files needed to build the Docker image. The Project as Environment is defined as a section with subsection: <code>[Project &quot;disruptive-app&quot;]</code></p>

<ul>
<li><code>Repository</code> (mandatory): Github repository SSH clone URL, the branch can be added to the end of the URL preceded of a <code>!</code> (eg.: <code>git@github.com:mcuadros/dockership.git!master</code>)</li>
<li><code>Dockerfile</code> (default: Dockerfile): the path to the Dockerfile at the repository.</li>
<li><code>RelatedRepositories</code> (optional, multiple): SSH clone URL to dependent repositories. (Link to more explanatory document)</li>
<li><code>History</code> (default: 3): Number to old images you want to keep in each Docker server.</li>
<li><code>NoCache</code> (optional): Avoid to use the Docker cache (like &ndash;no-cache at <code>docker build</code>)</li>
<li><code>Port</code> (multiple, optional): container port to expose, format: <code>&lt;host-addr&gt;:&lt;host-port&gt;:&lt;container-port&gt;/&lt;proto&gt;</code> (like -p at <code>docker run</code>), additionaly the port can be configured just for one enviroment adding it to end of the port preceded by a <code>@</code> (eg: <code>2.2.2.2:80:80/tcp@live</code>)</li>
<li><code>Restart</code> (optional, default: no): restart policy to apply when a container exits (no, on-failure[:max-retry], always)  (like &ndash;restart at <code>docker run</code>)</li>
<li><code>Link</code> (multiple, optional): creates a Link to other project, when this project is deployed the linked projects are restarted (like -P at <code>docker run</code>)</li>
<li><code>Volume</code> (multiple, optional): mounts a Data Volume Container (like -v at <code>docker run</code>)</li>
<li><code>VolumeFrom</code> (multiple, optional): mounts a Data Volumes From  a specified container (like &ndash;volumes-from at <code>docker run</code>)</li>
<li><code>GithubToken</code> (default: Global.GithubToken): the token needed to access this repository, if it is different from the global one.</li>
<li><code>Environment</code> (multiple, mandatory): Environment name where this project could be deployed</li>
<li><code>WebHook</code> (optional): An HTTP address. See <a href="https://github.com/mcuadros/dockership/blob/master/documentation/extending_dockership.md#web-hooks">Extending Dockership</a> for details.</li>
</ul>

<h2 id="toc_7">Example</h2>

<h3 id="toc_8">Scenario</h3>

<h4 id="toc_9">rest-service project</h4>

<p>REST webservice in Python running under a uwsgi+nginx on port 8080</p>

<p>This repository requires the python package <code>domain</code>, so we want to detect if the rest-service has pending changes to be deployed when the domain has new commits, even when the <code>rest-service</code> repository does not have new commits.</p>

<h4 id="toc_10">frontend project</h4>

<p>An AngularJS frontend running on a nginx server, with a <code>reverse_proxy</code> pointing to the port 8080 at rest-service container, in the path <code>/rest</code>.</p>

<p>We want to expose the port 80 at the host server.</p>

<h3 id="toc_11">Config file</h3>

<pre><code class="language-ini">[Global]
GithubToken = example-token

[Project &quot;rest-service&quot;]
Repository = git@github.com:company/rest-service.git
Environment = live
Environment = dev
File = /tmp/container.py
RelatedRepository = git@github.com:company/domain.git

[Project &quot;frontend&quot;]
Repository = git@github.com:company/angular-client.git
Environment = live
Environment = dev
Port = 0.0.0.0:80:80/tcp
Link = rest-service:backend

[Environment &quot;live&quot;]
DockerEndPoint = http://live-1.example.com
DockerEndPoint = http://live-2.example.com

[Environment &quot;dev&quot;]
DockerEndPoint = http://dev.example.com
</code></pre>

</div>
  <footer class="container">
    <div class=" well well-sm">
        by <a target="_blank"  href=""></a>
        @ .
        <a target="_blank" href="">Under MIT License</a> /

        Logo by
        <a target="_blank" href="https://dribbble.com/cayeromero">Caye Romero</a>
    </div>
  </footer>
</body>
</html>

